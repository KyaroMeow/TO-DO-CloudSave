<UserControl x:Class="TO_DO.Views.MainView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:vm="clr-namespace:TO_DO.ViewModels"
             xmlns:enums="clr-namespace:TO_DO.Enums"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <UserControl.DataContext>
        <vm:MainViewModel/>
    </UserControl.DataContext>

    <DockPanel Margin="10">
        <!-- Верхняя панель с кнопками -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0 0 0 10">
            <Button Content="Сменить тему"
                    Command="{Binding ToggleThemeCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}" Margin="0 0 10 0"/>
            <Button Content="Выйти"
                    Command="{Binding LogoutCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}"/>
        </StackPanel>

        <StackPanel DockPanel.Dock="Top" Margin="0 0 0 10">
            <TextBox Text="{Binding NewTaskTitle, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="Новая задача"
                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                     Margin="0 0 0 10"/>
            <Button Content="Добавить" Command="{Binding AddTaskCommand}"
                    Style="{StaticResource MaterialDesignOutlinedButton}" Margin="0 0 0 20"/>
            <TextBox Text="{Binding SearchQuery, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="Поиск"
                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                     Margin="0 0 0 10"/>
            <ComboBox SelectedItem="{Binding SelectedFilter}" Margin="0 0 0 10" Width="150">
                <ComboBox.ItemsSource>
                    <x:Array Type="{x:Type enums:TaskFilter}">
                        <enums:TaskFilter>All</enums:TaskFilter>
                        <enums:TaskFilter>Active</enums:TaskFilter>
                        <enums:TaskFilter>Completed</enums:TaskFilter>
                    </x:Array>
                </ComboBox.ItemsSource>
            </ComboBox>
            <Button Content="Управление тегами" 
                    Command="{Binding OpenTagsManagerCommand}" 
                    Style="{StaticResource MaterialDesignOutlinedButton}"
                    Width="170" Margin="0 0 0 10"/>
        </StackPanel>

        <!-- Основная область -->
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Активные -->
            <StackPanel Grid.Column="0" Margin="5">
                <TextBlock Text="Активные задачи" FontWeight="Bold" Margin="0 0 0 10"/>
                <ScrollViewer Height="300">
                    <ListBox x:Name="ActiveListBox"
                             ItemsSource="{Binding ActiveTasks}"
                             PreviewMouseLeftButtonDown="ListBox_PreviewMouseLeftButtonDown"
                             MouseMove="ListBox_MouseMove"
                             Drop="ActiveListBox_Drop"
                             AllowDrop="True"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel Margin="5">
                                    <CheckBox Content="{Binding Title}"
                                              IsChecked="{Binding IsCompleted}"
                                              Command="{Binding DataContext.ToggleTaskCompletionCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              CommandParameter="{Binding}" />
                                    <Button Content="✏"
                                            Command="{Binding DataContext.EditTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"
                                            Margin="5 0"/>
                                    <Button Content="❌"
                                            Command="{Binding DataContext.RemoveTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"
                                            Margin="5 0"/>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </StackPanel>

            <!-- Выполненные -->
            <StackPanel Grid.Column="1" Margin="5">
                <TextBlock Text="Выполненные задачи" FontWeight="Bold" Margin="0 0 0 10"/>
                <ScrollViewer Height="300">
                    <ListBox x:Name="CompletedListBox"
                             ItemsSource="{Binding CompletedTasks}"
                             PreviewMouseLeftButtonDown="ListBox_PreviewMouseLeftButtonDown"
                             MouseMove="ListBox_MouseMove"
                             Drop="CompletedListBox_Drop"
                             AllowDrop="True"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <DockPanel Margin="5">
                                    <CheckBox Content="{Binding Title}"
                                              IsChecked="{Binding IsCompleted}"
                                              Command="{Binding DataContext.ToggleTaskCompletionCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                              CommandParameter="{Binding}" />
                                    <Button Content="✏"
                                            Command="{Binding DataContext.EditTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"
                                            Margin="5 0"/>
                                    <Button Content="❌"
                                            Command="{Binding DataContext.RemoveTaskCommand, RelativeSource={RelativeSource AncestorType=ListBox}}"
                                            CommandParameter="{Binding}"
                                            Margin="5 0"/>
                                </DockPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </ScrollViewer>
            </StackPanel>
        </Grid>
    </DockPanel>
</UserControl>
